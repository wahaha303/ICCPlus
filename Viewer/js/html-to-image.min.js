!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).htmlToImage={})}(this,function(t){"use strict";function e(t,e,n,r){return new(n=n||Promise)(function(i,o){function c(t){try{a(r.next(t))}catch(e){o(e)}}function u(t){try{a(r.throw(t))}catch(e){o(e)}}function a(t){var e;t.done?i(t.value):((e=t.value)instanceof n?e:new n(function(t){t(e)})).then(c,u)}a((r=r.apply(t,e||[])).next())})}function n(t,e){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},c={next:u(0),throw:u(1),return:u(2)};return"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function u(u){return function(a){var s=[u,a];if(n)throw TypeError("Generator is already executing.");for(;c&&s[c=0]&&(o=0),o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,(s=i?[2&s[0],i.value]:s)[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=0<(i=o.trys).length&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(l){s=[6,l],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}}}function r(t){for(var e=[],n=0,r=t.length;n<r;n++)e.push(t[n]);return e}function i(t,e){return(t=(t.ownerDocument.defaultView||window).getComputedStyle(t).getPropertyValue(e))?parseFloat(t.replace("px","")):0}function o(t,e){var n,r,o;return{width:(e=void 0===e?{}:e).width||(r=i(n=t,"border-left-width"),o=i(n,"border-right-width"),n.clientWidth+r+o),height:e.height||(r=i(n=t,"border-top-width"),o=i(n,"border-bottom-width"),n.clientHeight+r+o)}}function c(t){return new Promise(function(e,n){var r=new Image;r.decode=function(){return e(r)},r.onload=function(){return e(r)},r.onerror=n,r.crossOrigin="anonymous",r.decoding="async",r.src=t})}u=0;var u,a=function(t,e){return t instanceof e||null!==(t=Object.getPrototypeOf(t))&&(t.constructor.name===e.name||a(t,e))};function s(t,e,n){var i,o,c=window.getComputedStyle(t,n),a=c.getPropertyValue("content");if(""!==a&&"none"!==a){u+=1;var a="u".concat("0000".concat((1679616*Math.random()<<0).toString(36)).slice(-4)).concat(u);try{e.className="".concat(e.className," ").concat(a)}catch(s){return}var l=document.createElement("style");l.appendChild((a=".".concat(a,":").concat(n),n=c.cssText?(o=(n=c).getPropertyValue("content"),"".concat(n.cssText," content: '").concat(o.replace(/'|"/g,""),"';")):r(i=c).map(function(t){var e=i.getPropertyValue(t),n=i.getPropertyPriority(t);return"".concat(t,": ").concat(e).concat(n?" !important":"",";")}).join(" "),document.createTextNode("".concat(a,"{").concat(n,"}")))),e.appendChild(l)}}var l="application/font-woff",h="image/jpeg",f={woff:l,woff2:l,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:h,jpeg:h,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function d(t){return f[t=((t=/\.([^./]*?)$/g.exec(t))?t[1]:"").toLowerCase()]||""}function $(t){return -1!==t.search(/^(data:)/)}function v(t,e){return"data:".concat(e,";base64,").concat(t)}function g(t,r,i){return e(this,void 0,void 0,function(){var e,o;return n(this,function(n){switch(n.label){case 0:return[4,fetch(t,r)];case 1:if(404===(e=n.sent()).status)throw Error('Resource "'.concat(e.url,'" not found'));return[4,e.blob()];case 2:return o=n.sent(),[2,new Promise(function(t,n){var r=new FileReader;r.onerror=n,r.onloadend=function(){try{t(i({res:e,result:r.result}))}catch(o){n(o)}},r.readAsDataURL(o)})]}})})}var p={};function w(t,r,i){return e(this,void 0,void 0,function(){var e,o,c,u;return n(this,function(n){var a,s,l,h;switch(n.label){case 0:if(a=t,s=r,l=i.includeQueryParams,h=a.replace(/\?.*/,""),/ttf|otf|eot|woff2?/i.test(h=l?a:h)&&(h=h.replace(/.*\//,"")),null!=p[e=s?"[".concat(s,"]").concat(h):h])return[2,p[e]];i.cacheBust&&(t+=(/\?/.test(t)?"&":"?")+(new Date).getTime()),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,g(t,i.fetchRequestInit,function(t){var e=t.res,t=t.result;return r=r||e.headers.get("Content-Type")||"",t.split(/,/)[1]})];case 2:return o=v(o=n.sent(),r),[3,4];case 3:return c=n.sent(),o=i.imagePlaceholder||"",u="Failed to fetch resource: ".concat(t),(u=c?"string"==typeof c?c:c.message:u)&&console.warn(u),[3,4];case 4:return[2,p[e]=o]}})})}var b=/url\((['"]?)([^'"]+?)\1\)/g,y=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,m=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function _(t){return -1!==t.search(b)}function x(t,r,i){return e(this,void 0,void 0,function(){var o;return n(this,function(c){var u,a,s;return _(t)?(a=t,o=(s=i.preferredFontFormat)?a.replace(m,function(t){for(;;){var e=y.exec(t)||[],n=e[0],e=e[2];if(!e)return"";if(e===s)return"src: ".concat(n,";")}}):a,u=[],o.replace(b,function(t,e,n){return u.push(n),t}),[2,u.filter(function(t){return!$(t)}).reduce(function(t,o){return t.then(function(t){return function(t,r,i,o,c){return e(this,void 0,void 0,function(){var e,u,a,s;return n(this,function(n){var l;switch(n.label){case 0:return n.trys.push([0,5,,6]),e=i?function(t,e){if(t.match(/^[a-z]+:\/\//i))return t;if(t.match(/^\/\//))return window.location.protocol+t;if(t.match(/^[a-z]+:/i))return t;var n=document.implementation.createHTMLDocument(),r=n.createElement("base"),i=n.createElement("a");return n.head.appendChild(r),n.body.appendChild(i),e&&(r.href=e),i.href=t,i.href}(r,i):r,u=d(r),a=void 0,c?[4,c(e)]:[3,2];case 1:return a=v(s=n.sent(),u),[3,4];case 2:return[4,w(e,u,o)];case 3:a=n.sent(),n.label=4;case 4:return[2,t.replace((l=r.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1"),RegExp("(url\\(['\"]?)(".concat(l,")(['\"]?\\))"),"g")),"$1".concat(a,"$3"))];case 5:return n.sent(),[3,6];case 6:return[2,t]}})})}(t,o,r,i)})},Promise.resolve(o))]):[2,t]})})}function S(t,r,i){var o;return e(this,void 0,void 0,function(){var e;return n(this,function(n){switch(n.label){case 0:return(e=null==(o=r.style)?void 0:o.getPropertyValue(t))?[4,x(e,null,i)]:[3,2];case 1:return e=n.sent(),r.style.setProperty(t,e,r.style.getPropertyPriority(t)),[2,!0];case 2:return[2,!1]}})})}var C={};function E(t){return e(this,void 0,void 0,function(){var e,r;return n(this,function(n){switch(n.label){case 0:return null!=(e=C[t])?[2,e]:[4,fetch(t)];case 1:return[4,n.sent().text()];case 2:return e={url:t,cssText:r=n.sent()},[2,C[t]=e]}})})}function R(t,r){return e(this,void 0,void 0,function(){var i,o,c,u=this;return n(this,function(a){return i=t.cssText,o=/url\(["']?([^"')]+)["']?\)/g,[2,Promise.all(c=(c=i.match(/url\([^)]+\)/g)||[]).map(function(c){return e(u,void 0,void 0,function(){var e;return n(this,function(n){return[2,g(e=(e=c.replace(o,"$1")).startsWith("https://")?e:new URL(e,t.url).href,r.fetchRequestInit,function(t){return t=t.result,i=i.replace(c,"url(".concat(t,")")),[c,t]})]})})})).then(function(){return i})]})})}function P(t){if(null==t)return[];for(var e=[],n=t.replace(/(\/\*[\s\S]*?\*\/)/gi,""),r=RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");null!==(i=r.exec(n));)e.push(i[0]);for(var i,n=n.replace(r,""),o=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,c=RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");;){if(null===(i=o.exec(n))){if(null===(i=c.exec(n)))break;o.lastIndex=c.lastIndex}else c.lastIndex=o.lastIndex;e.push(i[0])}return e}function A(t,i){return e(this,void 0,void 0,function(){var o;return n(this,function(c){switch(c.label){case 0:return[4,function t(i,o){return e(this,void 0,void 0,function(){return n(this,function(t){switch(t.label){case 0:if(null==i.ownerDocument)throw Error("Provided element is not within a Document");return[4,function(t,i){return e(this,void 0,void 0,function(){var e,o;return n(this,function(n){return e=[],o=[],t.forEach(function(e){if("cssRules"in e)try{r(e.cssRules||[]).forEach(function(t,n){var r;t.type===CSSRule.IMPORT_RULE&&(r=n+1,n=E(t.href).then(function(t){return R(t,i)}).then(function(t){return P(t).forEach(function(t){try{e.insertRule(t,t.startsWith("@import")?r+=1:e.cssRules.length)}catch(n){console.error("Error inserting rule from remote css",{rule:t,error:n})}})}).catch(function(t){console.error("Error loading remote css",t.toString())}),o.push(n))})}catch(n){var c=t.find(function(t){return null==t.href})||document.styleSheets[0];null!=e.href&&o.push(E(e.href).then(function(t){return R(t,i)}).then(function(t){return P(t).forEach(function(t){c.insertRule(t,e.cssRules.length)})}).catch(function(t){console.error("Error loading remote stylesheet",t)})),console.error("Error inlining remote css file",n)}}),[2,Promise.all(o).then(function(){return t.forEach(function(t){if("cssRules"in t)try{r(t.cssRules||[]).forEach(function(t){e.push(t)})}catch(n){console.error("Error while reading CSS rules from ".concat(t.href),n)}}),e})]})})}(r(i.ownerDocument.styleSheets),o)];case 1:return[2,t.sent().filter(function(t){return t.type===CSSRule.FONT_FACE_RULE}).filter(function(t){return _(t.style.getPropertyValue("src"))})]}})})}(t,i)];case 1:return[4,Promise.all((o=c.sent()).map(function(t){var e=t.parentStyleSheet?t.parentStyleSheet.href:null;return x(t.cssText,e,i)}))];case 2:return[2,c.sent().join("\n")]}})})}function N(t,i){return void 0===i&&(i={}),e(this,void 0,void 0,function(){var u,l,h;return n(this,function(f){var v,g,p;switch(f.label){case 0:return u=(l=o(t,i)).width,l=l.height,[4,function t(i,o,u){return e(this,void 0,void 0,function(){return n(this,function(l){return u||!o.filter||o.filter(i)?[2,Promise.resolve(i).then(function(r){return function(r,i){return e(this,void 0,void 0,function(){return n(this,function(o){return a(r,HTMLCanvasElement)?[2,function(t){return e(this,void 0,void 0,function(){var e;return n(this,function(n){return"data:,"===(e=t.toDataURL())?[2,t.cloneNode(!1)]:[2,c(e)]})})}(r)]:a(r,HTMLVideoElement)?[2,function(t,r){return e(this,void 0,void 0,function(){var e,i;return n(this,function(n){switch(n.label){case 0:return t.currentSrc?(e=(i=document.createElement("canvas")).getContext("2d"),i.width=t.clientWidth,i.height=t.clientHeight,null!=e&&e.drawImage(t,0,0,i.width,i.height),[2,c(i.toDataURL())]):(i=d(e=t.poster),[4,w(e,i,r)]);case 1:return[2,c(n.sent())]}})})}(r,i)]:a(r,HTMLIFrameElement)?[2,function(r){var i;return e(this,void 0,void 0,function(){return n(this,function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),null!=(i=null==r?void 0:r.contentDocument)&&i.body?[4,t(r.contentDocument.body,{},!0)]:[3,2];case 1:return[2,e.sent()];case 2:return[3,4];case 3:return e.sent(),[3,4];case 4:return[2,r.cloneNode(!1)]}})})}(r)]:[2,r.cloneNode(!1)]})})}(r,o)}).then(function(c){return function(i,o,c){var u;return e(this,void 0,void 0,function(){var e;return n(this,function(n){switch(n.label){case 0:return e=[],0===(e=null!=i.tagName&&"SLOT"===i.tagName.toUpperCase()&&i.assignedNodes?r(i.assignedNodes()):a(i,HTMLIFrameElement)&&null!=(u=i.contentDocument)&&u.body?r(i.contentDocument.body.childNodes):r((null!=(u=i.shadowRoot)?u:i).childNodes)).length||a(i,HTMLVideoElement)?[2,o]:[4,e.reduce(function(e,n){return e.then(function(){return t(n,c)}).then(function(t){t&&o.appendChild(t)})},Promise.resolve())];case 1:return n.sent(),[2,o]}})})}(i,c,o)}).then(function(t){var e,n,o,c,u,l,h,f;return e=i,a(t,Element)&&(u=e,(f=(l=t).style)&&((h=window.getComputedStyle(u)).cssText?(f.cssText=h.cssText,f.transformOrigin=h.transformOrigin):r(h).forEach(function(t){var e,n=h.getPropertyValue(t);"font-size"===t&&n.endsWith("px")&&(e=Math.floor(parseFloat(n.substring(0,n.length-2)))-.1,n="".concat(e,"px")),a(u,HTMLIFrameElement)&&"display"===t&&"inline"===n&&(n="block"),"d"===t&&l.getAttribute("d")&&(n="path(".concat(l.getAttribute("d"),")")),f.setProperty(t,n,h.getPropertyPriority(t))})),s(o=e,c=t,":before"),s(o,c,":after"),o=t,a(c=e,HTMLTextAreaElement)&&(o.innerHTML=c.value),a(c,HTMLInputElement)&&o.setAttribute("value",c.value),o=t,a(n=e,HTMLSelectElement)&&(o=Array.from(o.children).find(function(t){return n.value===t.getAttribute("value")}))&&o.setAttribute("selected","")),t}).then(function(r){return function(r,i){return e(this,void 0,void 0,function(){var e,o,c,u,a,s,l,h,f,d;return n(this,function(n){switch(n.label){case 0:if(0===(e=r.querySelectorAll?r.querySelectorAll("use"):[]).length)return[2,r];o={},d=0,n.label=1;case 1:return d<e.length?(h=(h=e[d]).getAttribute("xlink:href"))?(l=r.querySelector(h),c=document.querySelector(h),l||!c||o[h]?[3,3]:(u=o,a=h,[4,t(c,i,!0)])):[3,3]:[3,4];case 2:u[a]=n.sent(),n.label=3;case 3:return d++,[3,1];case 4:if((s=Object.values(o)).length){for(l="http://www.w3.org/1999/xhtml",(h=document.createElementNS(l,"svg")).setAttribute("xmlns",l),h.style.position="absolute",h.style.width="0",h.style.height="0",h.style.overflow="hidden",h.style.display="none",f=document.createElementNS(l,"defs"),h.appendChild(f),d=0;d<s.length;d++)f.appendChild(s[d]);r.appendChild(h)}return[2,r]}})})}(r,o)})]:[2,null]})})}(t,i,!0)];case 1:return[4,function(t,r){return e(this,void 0,void 0,function(){var e,i,o,c;return n(this,function(n){switch(n.label){case 0:return null==r.fontEmbedCSS?[3,1]:(e=r.fontEmbedCSS,[3,5]);case 1:return r.skipFonts?(i=null,[3,4]):[3,2];case 2:return[4,A(t,r)];case 3:i=n.sent(),n.label=4;case 4:e=i,n.label=5;case 5:return(c=e)&&(o=document.createElement("style"),c=document.createTextNode(c),o.appendChild(c),t.firstChild?t.insertBefore(o,t.firstChild):t.appendChild(o)),[2]}})})}(h=f.sent(),i)];case 2:return f.sent(),[4,function t(i,o){return e(this,void 0,void 0,function(){return n(this,function(c){switch(c.label){case 0:return a(i,Element)?[4,function(t,r){return e(this,void 0,void 0,function(){return n(this,function(e){switch(e.label){case 0:return[4,S("background",t,r)];case 1:return e.sent()?[3,3]:[4,S("background-image",t,r)];case 2:e.sent(),e.label=3;case 3:return[4,S("mask",t,r)];case 4:return e.sent()?[3,6]:[4,S("mask-image",t,r)];case 5:e.sent(),e.label=6;case 6:return[2]}})})}(i,o)]:[3,4];case 1:return c.sent(),[4,function(t,r){return e(this,void 0,void 0,function(){var e,i,o;return n(this,function(n){switch(n.label){case 0:return(e=a(t,HTMLImageElement))&&!$(t.src)||a(t,SVGImageElement)&&!$(t.href.baseVal)?[4,w(i=e?t.src:t.href.baseVal,d(i),r)]:[2];case 1:return o=n.sent(),[4,new Promise(function(n,r){t.onload=n,t.onerror=r,(r=t).decode&&(r.decode=n),"lazy"===r.loading&&(r.loading="eager"),e?(t.srcset="",t.src=o):t.href.baseVal=o})];case 2:return n.sent(),[2]}})})}(i,o)];case 2:return c.sent(),[4,function(i,o){return e(this,void 0,void 0,function(){var e;return n(this,function(n){switch(n.label){case 0:return[4,Promise.all(e=(e=r(i.childNodes)).map(function(e){return t(e,o)})).then(function(){return i})];case 1:return n.sent(),[2]}})})}(i,o)];case 3:c.sent(),c.label=4;case 4:return[2]}})})}(h,i)];case 3:return f.sent(),v=i,g=h.style,v.backgroundColor&&(g.backgroundColor=v.backgroundColor),v.width&&(g.width="".concat(v.width,"px")),v.height&&(g.height="".concat(v.height,"px")),null!=(p=v.style)&&Object.keys(p).forEach(function(t){g[t]=p[t]}),[4,function t(r,i,o){return e(this,void 0,void 0,function(){var t,c;return n(this,function(u){return c="http://www.w3.org/2000/svg",t=document.createElementNS(c,"svg"),c=document.createElementNS(c,"foreignObject"),t.setAttribute("width","".concat(i)),t.setAttribute("height","".concat(o)),t.setAttribute("viewBox","0 0 ".concat(i," ").concat(o)),c.setAttribute("width","100%"),c.setAttribute("height","100%"),c.setAttribute("x","0"),c.setAttribute("y","0"),c.setAttribute("externalResourcesRequired","true"),t.appendChild(c),c.appendChild(r),[2,function(t){return e(this,void 0,void 0,function(){return n(this,function(e){return[2,Promise.resolve().then(function(){return(new XMLSerializer).serializeToString(t)}).then(encodeURIComponent).then(function(t){return"data:image/svg+xml;charset=utf-8,".concat(t)})]})})}(t)]})})}(h,u,l)];case 4:return[2,f.sent()]}})})}function k(t,r){return void 0===r&&(r={}),e(this,void 0,void 0,function(){var e,i,u,a,s,l,h,f;return n(this,function(n){var d;switch(n.label){case 0:return e=(i=o(t,r)).width,i=i.height,[4,N(t,r)];case 1:return[4,c(n.sent())];case 2:return u=n.sent(),s=(a=document.createElement("canvas")).getContext("2d"),l=r.pixelRatio||function(){try{n=process}catch(t){}var e,n=n&&n.env?n.env.devicePixelRatio:null;return n&&Number.isNaN(e=parseInt(n,10))&&(e=1),e||window.devicePixelRatio||1}(),h=r.canvasWidth||e,f=r.canvasHeight||i,a.width=h*l,a.height=f*l,r.skipAutoScale||((d=a).width>16384||d.height>16384)&&(d.width>16384&&d.height>16384?d.width>d.height?(d.height*=16384/d.width,d.width=16384):(d.width*=16384/d.height,d.height=16384):d.width>16384?(d.height*=16384/d.width,d.width=16384):(d.width*=16384/d.height,d.height=16384)),a.style.width="".concat(h),a.style.height="".concat(f),r.backgroundColor&&(s.fillStyle=r.backgroundColor,s.fillRect(0,0,a.width,a.height)),s.drawImage(u,0,0,a.width,a.height),[2,a]}})})}t.getFontEmbedCSS=function(t,r){return void 0===r&&(r={}),e(this,void 0,void 0,function(){return n(this,function(e){return[2,A(t,r)]})})},t.toBlob=function(t,r){return void 0===r&&(r={}),e(this,void 0,void 0,function(){return n(this,function(e){switch(e.label){case 0:return console.log(e),[4,k(t,r)];case 1:var n,i,i=r;return console.log(e),[4,(n=e.sent(),console.log(n),void 0===i&&(i={}),new Promise(n.toBlob?function(t){n.toBlob(t,i.type||"image/png",i.quality||1)}:function(t){for(var e,r=window.atob(n.toDataURL(i.type||void 0,i.quality||void 0).split(",")[1]),e=r.length,o=new Uint8Array(e),c=0;c<e;c+=1)o[c]=r.charCodeAt(c);t(new Blob([o],{type:i.type||"image/png"}))})),console.log(e)];case 2:return console.log(e),[2,e.sent()]}})})},t.toCanvas=k,t.toJpeg=function(t,r){return void 0===r&&(r={}),e(this,void 0,void 0,function(){return n(this,function(e){switch(e.label){case 0:return[4,k(t,r)];case 1:return[2,e.sent().toDataURL("image/jpeg",r.quality||1)]}})})},t.toPixelData=function(t,r){return void 0===r&&(r={}),e(this,void 0,void 0,function(){var e,i;return n(this,function(n){switch(n.label){case 0:return e=(i=o(t,r)).width,i=i.height,[4,k(t,r)];case 1:return[2,n.sent().getContext("2d").getImageData(0,0,e,i).data]}})})},t.toPng=function(t,r){return void 0===r&&(r={}),e(this,void 0,void 0,function(){return n(this,function(e){switch(e.label){case 0:return[4,k(t,r)];case 1:return[2,e.sent().toDataURL()]}})})},t.toSvg=N});